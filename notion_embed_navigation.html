<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion Photo Navigation</title>
    <!-- Tailwind CSSを読み込み -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* カスタムスタイル: 要素を画面全体に広げ、Notionの埋め込みに最適化する */
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Notionの埋め込みで二重スクロールバーを防ぐ */
            font-family: 'Inter', sans-serif;
            background-color: #1f2937; /* ダークモードの背景に合わせる */
            color: #f3f4f6;
        }
        #app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }
        #navigation-bar {
            flex-shrink: 0;
        }
        #iframe-container {
            flex-grow: 1; /* iframeコンテナが利用可能なスペースをすべて占める */
            position: relative;
            /* Notion側の読み込みエラーメッセージを非表示にするために背景を白にしておく */
            background-color: #ffffff; 
        }
        #notion-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        /* アクティブなボタンのスタイル */
        .btn-active {
            background-color: #4f46e5 !important;
            color: white !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-800 text-gray-100">

    <div id="app-container">

        <!-- ナビゲーションバー (フィルタと切り替えボタン) -->
        <div id="navigation-bar" class="p-3 bg-gray-900 border-b border-gray-700 shadow-lg">
            
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-3 sm:space-y-0">
                
                <!-- 1. カテゴリフィルタ (タグによる分類) -->
                <div id="category-filters" class="flex flex-wrap gap-2">
                    <button class="filter-btn all-btn bg-gray-700 hover:bg-gray-600 text-sm font-semibold py-1 px-3 rounded-lg transition duration-150 btn-active" data-tag="all">
                        すべて
                    </button>
                    <!-- カテゴリボタンはJSでここに動的に追加されます -->
                </div>

                <!-- 2. ビュー切り替えボタン (表示形式の変更) -->
                <div id="view-toggles" class="flex gap-2">
                    <button class="view-btn grid-btn bg-gray-700 hover:bg-gray-600 text-sm font-semibold py-1 px-3 rounded-lg transition duration-150 btn-active" data-view="grid">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                    </button>
                    <button class="view-btn list-btn bg-gray-700 hover:bg-gray-600 text-sm font-semibold py-1 px-3 rounded-lg transition duration-150" data-view="list">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                    </button>
                </div>

            </div>
        </div>

        <!-- Notionの埋め込み先（iframe） -->
        <div id="iframe-container">
            <!-- ページの読み込み後にJSでiframeが挿入されます -->
        </div>

    </div>

    <script>
        // =================================================================
        // ユーザー設定エリア
        // =================================================================

        // 1. NotionのデータベースIDを設定してください。
        // 元のURL: https://mint-headlight-c47.notion.site/e3dfdc3f07e746af9076ecafd868f02f
        // ページIDのみを抽出: e3dfdc3f07e746af9076ecafd868f02f
        const NOTION_BASE_URL = "https://mint-headlight-c47.notion.site/ebd/e3dfdc3f07e746af9076ecafd868f02f"; 

        const VIEW_MAP = {
            // 【重要】「すべて」ボタンが指すデフォルトビューのID
            "all": "5cbfc69b6d6a4eadbdae06703ffe9b4f", 
             // Notionで新しく作成したフィルタ済みビューのIDをここに設定
            "寒色系": "2a1c1f65e39880c28f01000c353bae14", // ← 寒色系ビューのURLから取得
            "暖色系": "2a1c1f65e398800d9c2a000c7aedf618", // ← 暖色系ビューのURLから取得
            "ゾーン良好": "2a1c1f65e39880329729000cda2bd951", // ← ゾーン良好ビューのURLから取得
            "三分割": "2a1c1f65e398803b9e5f000c242a5231",
            // ... 必要なタグ分追加
        }:
        // 2. Notionの「タグ/カテゴリ」プロパティの選択肢を設定してください
        const NOTION_TAGS = [
            "寒色系",
            "暖色系",
            "ゾーン良好",
            "三分割",
            "Nature",
            "Urban",
        ];

        // 3. NotionのデータベースURLの末尾にあるビューIDを設定してください
        const VIEW_ID = "5cbfc69b6d6a4eadbdae06703ffe9b4f"; 

        // =================================================================
        // アプリケーションロジック
        // =================================================================

        const iframeContainer = document.getElementById('iframe-container');
        const filterContainer = document.getElementById('category-filters');
        const viewContainer = document.getElementById('view-toggles');
        let currentTag = 'all'; 
        let currentView = 'grid'; 

    /**
    * Notion埋め込みURLを生成する
    * @returns {string} - Notionの埋め込みURL
    */
       function generateNotionUrl() {
       // 【修正後のコード】ベースURLとビューIDを使用
             let url = NOTION_BASE_URL;

       // ビューIDをクエリパラメータとして付与
             let queryParams = [];
             if (VIEW_ID) {
                 queryParams.push(`v=${VIEW_ID}`);
             }

    // NotionにIFrame内での表示を強制させるためのパラメータを追加（元々含まれているはずですが念のため）
             queryParams.push(`embed=true`);

    // デバッグ情報 (カスタムフィルタのロジックは生かします)
             if (currentTag !== 'all' || currentView !== 'grid') {
                  queryParams.push(`custom_tag=${encodeURIComponent(currentTag)}`, `custom_view=${currentView}`);
             }

             if (queryParams.length > 0) {
        // ベースURLに既にクエリパラメータが含まれていないため、ここでは ? を使用
                 url += `?${queryParams.join('&')}`;
             }

             return url;
         }
        /**
         * iframeを再構築してNotionのコンテンツを読み込む
         */
        function loadNotionIframe() {
            const url = generateNotionUrl();
            
            // 既存のiframeを削除
            iframeContainer.innerHTML = '';

            // 新しいiframeを作成
            const iframe = document.createElement('iframe');
            iframe.id = 'notion-iframe';
            iframe.src = url;
            iframe.title = 'Notion Embedded Content';
            
　　　　　　　// iframeのsandbox属性に不足している権限を追加
　　　　　　　iframe.setAttribute(
    　　　　　　　'sandbox',
   　　　　　　　　'allow-scripts allow-same-origin allow-popups allow-forms allow-modals allow-pointer-lock allow-presentation allow-top-navigation-by-user-activation allow-downloads'
　　　　　　　);
            
            iframeContainer.appendChild(iframe);
            
            console.log("Notion Iframe Loaded with URL:", url);
        }

        /**
         * カテゴリフィルタボタンを動的に生成する
         */
        function renderCategoryFilters() {
            NOTION_TAGS.forEach(tag => {
                const button = document.createElement('button');
                button.className = 'filter-btn bg-gray-700 hover:bg-gray-600 text-sm font-semibold py-1 px-3 rounded-lg transition duration-150';
                button.textContent = tag;
                button.dataset.tag = tag;
                filterContainer.appendChild(button);
            });
        }

        /**
         * フィルタボタンのクリックイベントハンドラ
         */
        function handleFilterClick(event) {
            const target = event.target.closest('.filter-btn');
            if (!target) return;

            currentTag = target.dataset.tag;
            
            // アクティブクラスを切り替える
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('btn-active'));
            target.classList.add('btn-active');

            // iframeを再読み込み
            loadNotionIframe(); 
        }

        /**
         * ビュー切り替えボタンのクリックイベントハンドラ
         */
        function handleViewClick(event) {
            const target = event.target.closest('.view-btn');
            if (!target) return;

            currentView = target.dataset.view;
            
            // アクティブクラスを切り替える
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('btn-active'));
            target.classList.add('btn-active');
            
            // iframeを再読み込み
            loadNotionIframe();
        }

        // ページの初期化処理
        window.onload = function() {
            // カテゴリボタンの描画
            renderCategoryFilters();
            
            // 最初のURLでiframeを読み込む（すべて/グリッド）
            loadNotionIframe();

            // イベントリスナーの設定
            filterContainer.addEventListener('click', handleFilterClick);
            viewContainer.addEventListener('click', handleViewClick);
            
            // 【重要】未設定の警告
            if (NOTION_PAGE_ID === "YOUR_NOTION_PAGE_ID_HERE") {
                console.error("NotionのページIDが設定されていません。JS内の NOTION_PAGE_ID を更新してください。");
            }
        };

        // ページがiframe内で動作していることを検知するための簡易スクリプト
        try {
            if (window.self !== window.top) {
                console.log("Running inside an iframe (Notion embed).");
            }
        } catch (e) {
            console.log("Cannot determine if running inside an iframe.");
        }
    </script>

</body>
</html>

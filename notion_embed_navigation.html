<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion Photo Navigation</title>
    <!-- Tailwind CSSを読み込み -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* カスタムスタイル: 要素を画面全体に広げ、Notionの埋め込みに最適化する */
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Notionの埋め込みで二重スクロールバーを防ぐ */
            font-family: 'Inter', sans-serif;
            background-color: #1f2937; /* ダークモードの背景に合わせる */
            color: #f3f4f6;
        }
        #app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }
        #navigation-bar {
            flex-shrink: 0;
        }
        #iframe-container {
            flex-grow: 1; /* iframeコンテナが利用可能なスペースをすべて占める */
            position: relative;
        }
        #notion-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        /* アクティブなボタンのスタイル */
        .btn-active {
            background-color: #4f46e5 !important;
            color: white !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-800 text-gray-100">

    <div id="app-container">

        <!-- ナビゲーションバー (フィルタと切り替えボタン) -->
        <div id="navigation-bar" class="p-3 bg-gray-900 border-b border-gray-700 shadow-lg">
            
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-3 sm:space-y-0">
                
                <!-- 1. カテゴリフィルタ (タグによる分類) -->
                <div id="category-filters" class="flex flex-wrap gap-2">
                    <button class="filter-btn all-btn bg-gray-700 hover:bg-gray-600 text-sm font-semibold py-1 px-3 rounded-lg transition duration-150 btn-active" data-tag="all">
                        すべて
                    </button>
                    <!-- カテゴリボタンはJSでここに動的に追加されます -->
                </div>

                <!-- 2. ビュー切り替えボタン (表示形式の変更) -->
                <div id="view-toggles" class="flex gap-2">
                    <button class="view-btn grid-btn bg-gray-700 hover:bg-gray-600 text-sm font-semibold py-1 px-3 rounded-lg transition duration-150 btn-active" data-view="grid">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                    </button>
                    <button class="view-btn list-btn bg-gray-700 hover:bg-gray-600 text-sm font-semibold py-1 px-3 rounded-lg transition duration-150" data-view="list">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                    </button>
                </div>

            </div>
        </div>

        <!-- Notionの埋め込み先（iframe） -->
        <div id="iframe-container">
            <!-- ページの読み込み後にJSでiframeが挿入されます -->
        </div>

    </div>

    <script>
        // =================================================================
        // ユーザー設定エリア
        // =================================================================

        // 1. Notionのデータベース公開URLを設定してください
        // このURLは、ビューをフィルタリングする前の「すべて」のデータが表示された状態のリンクである必要があります。
        const BASE_NOTION_URL = "https://www.notion.so/e3dfdc3f07e746af9076ecafd868f02f?v=5cbfc69b6d6a4eadbdae06703ffe9b4f&source=copy_link"; 
        
        // 2. Notionの「タグ/カテゴリ」プロパティの選択肢を設定してください
        // ここに表示したいカテゴリ名を正確に入力してください。
        const NOTION_TAGS = [
            "寒色系",
            "暖色系",
            "ゾーン良好",
            "三分割",
            "Nature",
            "Urban",
        ];

        // 3. NotionのデータベースURLの末尾にあるビューIDを設定してください
        // URLの末尾にある `?v=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx` の部分です。
        // これがない場合、フィルタリングが機能しない可能性があります。
        const VIEW_ID = "5cbfc69b6d6a4eadbdae06703ffe9b4f"; // 例: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"

        // =================================================================
        // アプリケーションロジック
        // =================================================================

        const iframeContainer = document.getElementById('iframe-container');
        const filterContainer = document.getElementById('category-filters');
        const viewContainer = document.getElementById('view-toggles');
        let currentTag = 'all'; // 現在選択されているタグ
        let currentView = 'grid'; // 現在選択されているビュー

        /**
         * Notion埋め込みURLを生成する
         * @param {string} tag - フィルタリングするタグ名 ('all'の場合はフィルタリングなし)
         * @returns {string} - Notionの埋め込みURL
         */
        function generateNotionUrl(tag, viewMode) {
            let url = BASE_NOTION_URL;
            
            // ビューIDを追加（これがURLの末尾にあることを想定）
            if (VIEW_ID) {
                url += `?v=${VIEW_ID}`;
            }

            // タグによるフィルタリング
            if (tag !== 'all') {
                // NotionのURLエンコードルールに従ってフィルタリングパラメーターを追加
                // 複数のフィルタリング条件を `&f` パラメータに追加する形式は複雑なため、
                // この実装では単純なタグ（単一フィルタ）に基づいて `f` パラメータを構築します。
                
                // Notionのフィルタは非常に複雑なJSON形式を使用するため、
                // 実際にはユーザーが手動でNotionでフィルタを設定し、
                // その結果生成されたフィルタリング済みのURL全体を貼り付けるのが最も確実です。
                
                // ここでは、URLの最後にタグ名とビューモードをクエリとして追加する形にします。
                // 実際のフィルタリングは、Notionのビュー設定で事前に済ませておくことを強く推奨します。
                
                // **【重要】Notionの埋め込みフィルタの注意点:**
                // Notion埋め込みのフィルタリングは、URL内の複雑なJSON構造（`&f=...`）に依存します。
                // JavaScriptでこのJSONを動的に生成するのは困難でエラーになりやすいため、
                // **ユーザーがNotion内でカテゴリごとにビューを作成し、それぞれのビューの共有URLを
                // このJSの配列に設定し直す方が確実です**。
                
                // *今回は、ユーザーがNotion内でフィルタリングされたビューを事前に作成し、
                // BASE_NOTION_URLをそのカテゴリビューのURLに動的に置き換えるという、より単純で確実な方法を採用します。*

                // 代わりに、ユーザーにNotionで事前にビューを作成してもらい、
                // タグ名をURLに追加してiframeのリフレッシュを促します。（Notion側でのカスタム設定が必要）
                return `${BASE_NOTION_URL}&tag=${encodeURIComponent(tag)}&view=${viewMode}`;
            }
            
            // 'all' の場合はベースURLとビューモードのみ
            return `${BASE_NOTION_URL}&view=${viewMode}`;
        }

        /**
         * iframeを再構築してNotionのコンテンツを読み込む
         * @param {string} tag - 読み込むタグ
         * @param {string} viewMode - 読み込むビューモード
         */
        function loadNotionIframe(tag, viewMode) {
            const url = generateNotionUrl(tag, viewMode);
            
            // 既存のiframeを削除
            iframeContainer.innerHTML = '';

            // 新しいiframeを作成
            const iframe = document.createElement('iframe');
            iframe.id = 'notion-iframe';
            iframe.src = url;
            iframe.title = 'Notion Embedded Content';
            iframeContainer.appendChild(iframe);
            
            console.log("Notion Iframe Loaded with URL:", url);
        }

        /**
         * カテゴリフィルタボタンを動的に生成する
         */
        function renderCategoryFilters() {
            NOTION_TAGS.forEach(tag => {
                const button = document.createElement('button');
                button.className = 'filter-btn bg-gray-700 hover:bg-gray-600 text-sm font-semibold py-1 px-3 rounded-lg transition duration-150';
                button.textContent = tag;
                button.dataset.tag = tag;
                filterContainer.appendChild(button);
            });
        }

        /**
         * フィルタボタンのクリックイベントハンドラ
         */
        function handleFilterClick(event) {
            const target = event.target.closest('.filter-btn');
            if (!target) return;

            currentTag = target.dataset.tag;
            
            // アクティブクラスを切り替える
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('btn-active'));
            target.classList.add('btn-active');

            // iframeを再読み込み
            loadNotionIframe(currentTag, currentView);
        }

        /**
         * ビュー切り替えボタンのクリックイベントハンドラ
         */
        function handleViewClick(event) {
            const target = event.target.closest('.view-btn');
            if (!target) return;

            currentView = target.dataset.view;
            
            // アクティブクラスを切り替える
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('btn-active'));
            target.classList.add('btn-active');
            
            // iframeを再読み込み
            loadNotionIframe(currentTag, currentView);
        }

        // ページの初期化処理
        window.onload = function() {
            // カテゴリボタンの描画
            renderCategoryFilters();
            
            // 最初のURLでiframeを読み込む（すべて/グリッド）
            loadNotionIframe(currentTag, currentView);

            // イベントリスナーの設定
            filterContainer.addEventListener('click', handleFilterClick);
            viewContainer.addEventListener('click', handleViewClick);
            
            // 【重要】未設定の警告
            if (BASE_NOTION_URL === "YOUR_NOTION_SHARE_URL_HERE") {
                alert("Notionの公開URLが設定されていません。JS内の BASE_NOTION_URL を更新してください。");
                console.error("Notionの公開URLが設定されていません。JS内の BASE_NOTION_URL を更新してください。");
            }
        };

        // ページがiframe内で動作していることを検知するための簡易スクリプト
        try {
            if (window.self !== window.top) {
                console.log("Running inside an iframe (Notion embed).");
            }
        } catch (e) {
            console.log("Cannot determine if running inside an iframe.");
        }
    </script>

</body>
</html>
